---
title: "EDAV_Project"
author: "Pit Kauffmann"
date: "3/30/2018"
output: html_document
---

### Import necessary libraries:
```{r message = FALSE, warning = FALSE}
library(dplyr)
library(ggplot2)
library(ggmap)
library(readr)
library(plyr)
```

### Select city with highest cuisine diversity score
```{r message = FALSE, warning = FALSE}
setwd("~/Downloads/EDAV_project-master 2")
data = read_csv("number of restaurants by cuisine.csv")
data <- data %>% group_by(city, category) %>% summarize(count = sum(NumberOfRestaurants, na.rm = TRUE)) %>% mutate(perc = round(count/sum(count),4))

gini <- function(x, na.rm = TRUE) {
  index <- 1 - sum(x**2) 
  return(index)
}

data <- data %>% group_by(city) %>% summarise(gini = gini(perc))
data <- data[order(-data$gini),]
```

### Get data for Toronto
```{r message = FALSE, warning = FALSE}
setwd("~/Downloads/EDAV_project-master 2")
data = read_csv("reviews_in_Toronto.csv")
most_rev <- data.frame(table(data$business_id)) 
most_rev <- most_rev[order(-most_rev$Freq),]
most_rev$Var1 <- as.character(most_rev$Var1)
var <- most_rev$Var1[1]
reviews <- subset(data, business_id == var)
reviews <- reviews[order(as.Date(reviews$date, format="%Y-%m-%d")),]
reviews$year <- as.numeric(format(as.Date(reviews$date, format="%Y-%m-%d"),"%Y"))
reviews$month <- as.numeric(format(as.Date(reviews$date, format="%Y-%m-%d"),"%m"))
reviews$elite <- as.factor(reviews$elite)
levels(reviews$elite) <- c(0,1)
reviews <- reviews[c("business_id", "date", "stars", "elite", "text_1", "year", "month")]
reviews$date <- as.Date(reviews$date)

for (i in 2014:2017) {
  for (j in 1:12) {
    temp <- subset(reviews, reviews$date <= as.Date(paste(i,j,28, sep = "-"), format="%Y-%m-%d"))
    elite <- subset(temp, temp$elite == 1)
    ggplot(temp, aes(date, text_1)) + geom_line(color='grey') + scale_x_date(date_labels = ("%b-%Y"), limits =
      as.Date(c(reviews$date[1], reviews$date[nrow(reviews)]))) + xlab("Date") + ylab("Sentiment") + ylim(-1,1) +
      geom_point(data = elite, aes(date, text_1), color='darkblue', shape = 5) + ggtitle(paste(i, "_", j)) 
    ggsave(filename = paste(i, j, ".png", sep = ""), width = 4, height = 4, dpi = 200)
  }
}
```

```{r message = FALSE, warning = FALSE}
avg_sent <- reviews %>% group_by(stars) %>% summarize(mean = mean(text_1, na.rm = TRUE))
ggplot(avg_sent, aes(stars, mean)) + geom_col(color = "darkblue", fill = "darkblue") + xlab("Stars") + ylab("Average Review Sentiment")
```

```{r message = FALSE, warning = FALSE}
elite_sent <- data %>% group_by(elite) %>% summarize(mean = mean(text_1, na.rm = TRUE))
ggplot(elite_sent, aes(elite, mean)) + geom_col(color = "darkblue", fill = "darkblue", width = 0.5) + xlab("Elite") + ylab("Average Review Sentiment")
```

### Questions:
*   





```


